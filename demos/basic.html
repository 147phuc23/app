<!DOCTYPE html>

<head>
	<title>Basic App</title>

	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<link rel="stylesheet" href="../src/stylesheets/base.css">
	<style>
		body.demo-cursor {
			cursor: pointer;
			cursor: url(finger.png) 25 25, pointer;
		}
		body.demo-cursor:active {
			cursor: pointer;
			cursor: url(finger-active.png) 25 25, pointer;
		}
		ul.colour-picker {}
		ul.colour-picker li {
			display: block;
			float: left;
			height: 54px;
			width: 25%;
			background: #2B9;
			-webkit-box-sizing: border-box;
			box-sizing: border-box;
		}
		ul.colour-picker li[data-colour="green"] {
			background: #3C7;
		}
		ul.colour-picker li[data-colour="yellow"] {
			background: #EC1;
		}
		ul.colour-picker li[data-colour="orange"] {
			background: #E82;
		}
		ul.colour-picker li[data-colour="red"] {
			background: #E54;
		}
		ul.colour-picker li[data-colour="blue"] {
			background: #39D;
		}
		ul.colour-picker li[data-colour="dark-blue"] {
			background: #345;
		}
		ul.colour-picker li[data-colour="white"] {
			background: #FFF;
		}
	</style>
</head>



<div class="app-page" data-page="home">
	<div class="app-topbar">
		<div class="app-title"><span class="app-icon"></span>Basic App</div>
	</div>

	<div class="app-content">
		<p class="app-section">
			Welcome to the App.js default theme. Click around to see what each widget looks like.
		</p>

		<div class="app-section">
			<b>Topbar colours:</b><br>
			<ul class="colour-picker">
				<li data-colour=""></li>
				<li data-colour="green"></li>
				<li data-colour="yellow"></li>
				<li data-colour="orange"></li>
				<li data-colour="red"></li>
				<li data-colour="blue"></li>
				<li data-colour="dark-blue"></li>
				<li data-colour="white"></li>
				<div class="clear"></div>
			</ul>
		</div>

		<div class="app-section">
			<div class="app-button" data-target="lists">Lists</div>
			<div class="app-button" data-target="buttons">Buttons</div>
			<div class="app-button" data-target="inputs">Inputs</div>
		</div>
	</div>
</div>

<div class="app-page" data-page="lists">
	<div class="app-topbar">
		<div class="left app-button" data-back="true" data-autotitle="true"></div>
		<div class="app-title"><span class="app-icon"></span>Lists</div>
	</div>

	<div class="app-content">
		<ul class="app-list">
			<label>Label 1</label>
			<li class="app-button" data-target="lists">Item 1</li>
			<li class="app-button">Item 2</li>
			<li class="app-button">Item 3</li>
			<label>Label 2</label>
			<li>Item 4</li>
			<li>Item 5</li>
			<li>Item 6</li>
			<label>Label 3</label>
			<li>Item 7</li>
			<li>Item 8</li>
			<li>Item 9</li>
			<label>Label 4</label>
			<li>Item 10</li>
			<li>Item 11</li>
			<li>Item 12</li>
			<label>Label 5</label>
			<li>Item 13</li>
			<li>Item 14</li>
			<li>Item 15</li>
		</ul>
	</div>
</div>

<div class="app-page" data-page="buttons">
	<div class="app-topbar">
		<div class="left app-button" data-back="true" data-autotitle="true"></div>
		<div class="app-title"><span class="app-icon"></span>Buttons</div>
		<div class="right app-button app-menu">Dialog</div>
	</div>

	<div class="app-content">
		<div class="app-section">
			<ul class="app-list">
				<li class="app-button">Item 1</li>
				<li class="app-button">Item 2</li>
				<li class="app-button">Item 3</li>
			</ul>
		</div>

		<div class="app-section">
			<div class="app-button red">Button 1</div>
			<div class="app-button green">Button 2</div>
			<div class="app-button blue">Button 3</div>
		</div>
	</div>
</div>

<div class="app-page" data-page="inputs">
	<div class="app-topbar">
		<div class="left app-button" data-back="true" data-autotitle="true"></div>
		<div class="app-title"><span class="app-icon"></span>Inputs</div>
	</div>

	<div class="app-content">
		<input class="app-input" type="search" placeholder="Search..">

		<div class="app-section">
			<input class="app-input" placeholder="Input">
		</div>

		<form class="app-section">
			<input class="app-input" name="subject" placeholder="Subject">
			<textarea class="app-input" name="message" placeholder="Message"></textarea>
			<div class="app-button green">Send</div>
		</form>
	</div>
</div>



<script>
	(function (window, document) {
		var query = function (queryString) {
			var re           = /([^&=]+)=([^&]+)/g,
				decodedSpace = /\+/g;

			var result = {},
				m, key, value;

			if (queryString) {
				queryString = queryString.replace(decodedSpace, '%20');

				while ((m = re.exec(queryString))) {
					key   = decodeURIComponent( m[1] );
					value = decodeURIComponent( m[2] );
					result[ key ] = value;
				}
			}

			return result;
		}( window.location.href.split('?')[1] );

		if ( !query.style ) {
			return;
		}

		var link  = document.createElement('link');
		link.rel = 'stylesheet';
		link.href = '../src/stylesheets/'+query.style+'.css';
		document.querySelector('head').appendChild(link);

		if (query._app_platform) {
			document.body.className += ' demo-cursor';
		}
	})(window, document);
</script>

<script src="../src/lib/swapper.js"    ></script>
<script src="../src/lib/clickable.js"  ></script>
<script src="../src/lib/scrollable.js" ></script>
<script src="../src/app.js"            ></script>
<script src="../src/utils.js"          ></script>
<script src="../src/events.js"         ></script>
<script src="../src/metrics.js"        ></script>
<script src="../src/dialog.js"         ></script>
<script src="../src/pages.js"          ></script>
<script src="../src/core.js"           ></script>

<script>
	var colourPages = [],
		colour      = '';

	function setupPageColour (page) {
		var topbar = page.querySelector('.app-topbar');
		colourPages.push(topbar);
		if (colour) {
			topbar.classList.add(colour);
		}
	}

	App.populator('home'   , setupPageColour);
	App.populator('lists'  , setupPageColour);
	App.populator('buttons', setupPageColour);
	App.populator('inputs' , setupPageColour);



	App.populator('home', function (page) {
		Array.prototype.forEach.call(
			page.querySelectorAll('ul.colour-picker li'),
			function (colourButton) {
				colourButton
					.addEventListener('touchstart', function () {
						var oldColour = colour;
						colour = this.getAttribute('data-colour');

						if (oldColour === colour) {
							return;
						}

						colourPages.forEach(function (colourPage) {
							if (oldColour) {
								colourPage.classList.remove(oldColour);
							}
							if (colour) {
								colourPage.classList.add(colour);
							}
						});
					}, false);
			}
		);
	});

	App.populator('lists', function (page) {
		page.addEventListener('appShow', function () {
			console.log('lists page is visible');
		}, false);

		page.addEventListener('appHide', function () {
			console.log('lists page is invisible');
		}, false);

		page.addEventListener('appBack', function () {
			console.log('lists page is going back');
		}, false);

		page.addEventListener('appForward', function () {
			console.log('lists page is going forward');
		}, false);
	});

	App.populator('buttons', function (page) {
		page.querySelector('.app-menu').addEventListener('click', function () {
			App.dialog({
				tweetButton  : 'Share on Facebook' ,
				fbButton     : 'Share on Twitter'  ,
				gpButton     : 'Share on Google+'  ,
				okButton     : 'Share on Kik' ,
				cancelButton : 'Cancel'
			});
		}, false);
	});

	App.populator('inputs', function (page) {
		App.form(
			page.querySelector('form'),
			function (params, unlock) {
				console.log(params);
				unlock();
			}
		);
	});

App.form = function (form, callback) {
	//TODO: check if is node
	switch (typeof callback) {
		case 'undefined':
			callback = function () {};
		case 'function':
			break;
		default:
			throw TypeError('callback must be a function, got '+callback);
	}

	var isForm = (form.nodeName === 'FORM'),
		locked = false;

	if (isForm) {
		var submit = document.createElement('input');
		submit.style.display = 'none';
		submit.type = 'submit';
		form.appendChild(submit);
		form.addEventListener('submit', function (e) {
			e.preventDefault();
			submitForm();
		}, false);
	}
	else {
		form.addEventListener('keydown', function (e) {
			if (e.which === 13) {
				e.preventDefault();
				submitForm();
			}
		}, false);
	}

	function submitForm () {
		if (locked) {
			return;
		}
		locked = true;
		form.disabled = true;

		var params = {},
			inputs = isForm ? form.querySelectorAll('[name]') : [form],
			done   = false;

		if (isForm) {
			Array.prototype.forEach.call(
				form.querySelectorAll('[name]'),
				function (elem) {
					params[elem.name] = elem.value;
				}
			);
		}
		else {
			params.value = form.value;
			if (form.name) {
				params[form.name] = form.value;
			}
		}

		Array.prototype.forEach.call(
			inputs,
			function (elem) {
				elem.disabled = true;
			}
		);

		callback.call(this, params, function () {
			if (done) {
				return;
			}
			done = true;

			Array.prototype.forEach.call(
				inputs,
				function (elem) {
					elem.disabled = false;
				}
			);

			locked = false;
			form.disabled = false;
		});
	}
};

	try {
		App.restore();
	}
	catch (err) {
		App.load('home');
	}
</script>

<script src="http://cdn.kik.com/cards/0/cards.js"></script>
